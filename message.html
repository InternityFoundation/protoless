<html><head><title>protoless: Encode & decode protobuf messages</title><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Julien Lafont" /><meta name="description" content="Type-safe and schema-free Protobuf library for Scala" /><meta name="og:image" content="/protoless/img/poster.png" /><meta name="og:title" content="protoless: Encode & decode protobuf messages" /><meta name="og:site_name" content="protoless" /><meta name="og:url" content="https://julien-lafont.github.io/protoless" /><meta name="og:type" content="website" /><meta name="og:description" content="Type-safe and schema-free Protobuf library for Scala" /><link rel="icon" type="image/png" href="/protoless/img/favicon.png" /><meta name="twitter:title" content="protoless: Encode & decode protobuf messages" /><meta name="twitter:image" content="https://julien-lafont.github.io/protolessimg/poster.png" /><meta name="twitter:description" content="Type-safe and schema-free Protobuf library for Scala" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:creator" content="@julien_lafont" /><link rel="icon" type="image/png" sizes="16x16" href="/protoless/img/favicon16x16.png" /><link rel="icon" type="image/png" sizes="24x24" href="/protoless/img/favicon24x24.png" /><link rel="icon" type="image/png" sizes="32x32" href="/protoless/img/favicon32x32.png" /><link rel="icon" type="image/png" sizes="48x48" href="/protoless/img/favicon48x48.png" /><link rel="icon" type="image/png" sizes="57x57" href="/protoless/img/favicon57x57.png" /><link rel="icon" type="image/png" sizes="60x60" href="/protoless/img/favicon60x60.png" /><link rel="icon" type="image/png" sizes="64x64" href="/protoless/img/favicon64x64.png" /><link rel="icon" type="image/png" sizes="70x70" href="/protoless/img/favicon70x70.png" /><link rel="icon" type="image/png" sizes="72x72" href="/protoless/img/favicon72x72.png" /><link rel="icon" type="image/png" sizes="76x76" href="/protoless/img/favicon76x76.png" /><link rel="icon" type="image/png" sizes="96x96" href="/protoless/img/favicon96x96.png" /><link rel="icon" type="image/png" sizes="114x114" href="/protoless/img/favicon114x114.png" /><link rel="icon" type="image/png" sizes="120x120" href="/protoless/img/favicon120x120.png" /><link rel="icon" type="image/png" sizes="128x128" href="/protoless/img/favicon128x128.png" /><link rel="icon" type="image/png" sizes="144x144" href="/protoless/img/favicon144x144.png" /><link rel="icon" type="image/png" sizes="150x150" href="/protoless/img/favicon150x150.png" /><link rel="icon" type="image/png" sizes="152x152" href="/protoless/img/favicon152x152.png" /><link rel="icon" type="image/png" sizes="196x196" href="/protoless/img/favicon196x196.png" /><link rel="icon" type="image/png" sizes="310x310" href="/protoless/img/favicon310x310.png" /><link rel="icon" type="image/png" sizes="310x150" href="/protoless/img/favicon310x150.png" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" /><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" /><link rel="stylesheet" href="/protoless/highlight/styles/atom-one-dark.css" /><link rel="stylesheet" href="/protoless/css/style.css" /><link rel="stylesheet" href="/protoless/css/palette.css" /><link rel="stylesheet" href="/protoless/css/codemirror.css" /><script async="async">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-40626968-2' , 'auto');
ga('send', 'pageview');
      </script></head><body class="docs"><div id="wrapper"><div id="sidebar-wrapper"><ul id="sidebar" class="sidebar-nav"><li class="sidebar-brand"><a href="/protoless/" class="brand"><div class="brand-wrapper"><span>protoless</span></div></a></li> <li><a href="/protoless/design.html" class="">Library Design</a></li> <li><a href="/protoless/message.html" class="">Message Encoder & Decoder</a></li> <li><a href="/protoless/field.html" class="">Field Encoder & Decoder</a></li></ul></div><div id="page-content-wrapper"><div class="nav"><div class="container-fluid"><div class="row"><div class="col-lg-12"><div class="action-menu pull-left clearfix"><a href="#menu-toggle" id="menu-toggle"><i class="fa fa-bars" aria-hidden="true"></i></a></div><ul class="pull-right"><li id="gh-eyes-item" class="hidden-xs"><a href="https://github.com/julien-lafont/protoless"><i class="fa fa-eye"></i><span>WATCH<span id="eyes" class="label label-default">--</span></span></a></li><li id="gh-stars-item" class="hidden-xs"><a href="https://github.com/julien-lafont/protoless"><i class="fa fa-star-o"></i><span>STARS<span id="stars" class="label label-default">--</span></span></a></li><li><a href="#" onclick="shareSiteTwitter('protoless Type-safe and schema-free Protobuf library for Scala');"><i class="fa fa-twitter"></i></a></li><li><a href="#" onclick="shareSiteFacebook('protoless Type-safe and schema-free Protobuf library for Scala');"><i class="fa fa-facebook"></i></a></li><li><a href="#" onclick="shareSiteGoogle();"><i class="fa fa-google-plus"></i></a></li></ul></div></div></div></div><div id="content" data-github-owner="julien-lafont" data-github-repo="protoless"><div class="content-wrapper"><section><h1 id="encode--decode-protobuf-messages">Encode &amp; decode protobuf messages</h1>

<p>Encoders and Decoders for protobuf Messages can be created in three different ways:</p>
<ul>
  <li><a href="#fully-automatic-derivation">Fully Automatic derivation</a>: encoders &amp; decoders will automatically be derived from your models. All the fields in the
proto schema <strong>must</strong> be numbered consecutively starting from one.</li>
  <li><a href="#semi-automatic-derivation">Semi-automatic derivation</a> (<strong>recommended</strong>): you have to derive an encoder/decoder for each case class involved in
protobuf serialization. You can derive with automatic field numbering, or configure a specific mapping.</li>
  <li><a href="#hand-crafted-encodersdecoders">Hand-crafted encoders/decoders</a>: you have the freedom to compose your own encoders/decoders using existing bricks.</li>
</ul>

<div id="diagram"></div>

<script type="text/javascript">
    document.addEventListener("DOMContentLoaded", function(event) {
        var diagram = flowchart.parse(
            'st=>start: Which strategy shoud I use?\n' +

            'endAuto=>end: Fully Automatic derivation:>#fully-automatic-derivation\n' +
            'endSemi=>end: Semi-Automatic derivation:>#semi-automatic-derivation\n' +
            'endCraft=>end: Hand-crafted encoders/decoders:>#hand-crafted-encodersdecoders\n' +


            'cond0=>condition: Do you intend to\n' +
            'validate or transform fields\n' +
            'individually?\n' +

            'cond1=>condition: Are the fields\n' +
            'numbered consecutively\n' +
            'starting from one?\n' +

            'cond2=>condition: Do you like\n' +
            'magic?\n' +

            'st->cond0\n' +
            'cond0(yes)->endCraft\n' +
            'cond0(no)->cond1(yes)->cond2\n' +
            'cond1(no)->endSemi(left)\n' +
            'cond2(no)->endSemi(left)s\n' +
            'cond2(yes, left)->endAuto\n');

        diagram.drawSVG('diagram');
    });
</script>

<h2 id="semi-automatic-derivation">Semi-automatic derivation</h2>

<h3 id="usage">Usage</h3>

<p>Suppose that we need to work with the following proto3 schema:</p>

<div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">Student</span> <span class="p">{</span>
  <span class="kt">int64</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="c1">//uint32 age = 3; -- Deprecated in favor of birthDate
</span>  <span class="kt">string</span> <span class="na">birthDate</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">libraryCard</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">Course</span> <span class="na">courses</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">message</span> <span class="nc">Course</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">double</span> <span class="na">price</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="na">external</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Note that the <code class="highlighter-rouge">Student</code> schema has certainly evolved many times, because the numbering is not sequential, unlike the <code class="highlighter-rouge">Course</code>, which is numbered consecutively.</p>

<p>In your application, we want to use these types:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">cats.data.NonEmptyList</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Course</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">price</span><span class="k">:</span> <span class="kt">Double</span><span class="o">)</span> <span class="c1">// we doesn't care about the `external` field
</span><span class="k">case</span> <span class="k">class</span> <span class="nc">StudentId</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">AnyVal</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Student</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">StudentId</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">birthDate</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">courses</span><span class="k">:</span> <span class="kt">NonEmptyList</span><span class="o">[</span><span class="kt">Course</span><span class="o">])</span>
</code></pre></div></div>

<p>You can summon encoders and decoders for these models with <code class="highlighter-rouge">deriveEncoder</code> and <code class="highlighter-rouge">deriveDecoder</code>, respectively :</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.protoless.generic.semiauto._</span>
<span class="k">import</span> <span class="nn">shapeless.</span><span class="o">{::,</span> <span class="nc">HNil</span><span class="o">,</span> <span class="nc">Nat</span><span class="o">}</span>

<span class="c1">// Summon automatic decoder for course (note that we will read a partial representation of the message Course)
</span><span class="k">implicit</span> <span class="k">val</span> <span class="n">courseDecoder</span> <span class="k">=</span> <span class="n">deriveDecoder</span><span class="o">[</span><span class="kt">Course</span><span class="o">]</span>

<span class="c1">// Summon a decoder for student with a custom mapping between fields (studentId: 1, name: 2, birthDate: 4, courses: 8)
</span><span class="k">implicit</span> <span class="k">val</span> <span class="n">studentDecoder</span> <span class="k">=</span> <span class="n">deriveDecoder</span><span class="o">[</span><span class="kt">Student</span>, <span class="kt">Nat.</span><span class="k">_</span><span class="err">1</span> <span class="kt">::</span> <span class="kt">Nat.</span><span class="k">_</span><span class="err">2</span> <span class="kt">::</span> <span class="kt">Nat.</span><span class="k">_</span><span class="err">4</span> <span class="kt">::</span> <span class="kt">Nat.</span><span class="k">_</span><span class="err">8</span> <span class="kt">::</span> <span class="kt">HNil</span><span class="o">]</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">courseEncoder</span> <span class="k">=</span> <span class="n">deriveEncoder</span><span class="o">[</span><span class="kt">Course</span><span class="o">]</span>
<span class="k">implicit</span> <span class="k">val</span> <span class="n">studentEncoder</span> <span class="k">=</span> <span class="n">deriveEncoder</span><span class="o">[</span><span class="kt">Student</span>, <span class="kt">Nat.</span><span class="k">_</span><span class="err">1</span> <span class="kt">::</span> <span class="kt">Nat.</span><span class="k">_</span><span class="err">2</span> <span class="kt">::</span> <span class="kt">Nat.</span><span class="k">_</span><span class="err">4</span> <span class="kt">::</span> <span class="kt">Nat.</span><span class="k">_</span><span class="err">8</span> <span class="kt">::</span> <span class="kt">HNil</span><span class="o">]</span> <span class="c1">// tips: move the fields definition in a type alias
</span></code></pre></div></div>

<p>You’re ready to encode and decode protobuf messages:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">student</span> <span class="k">=</span> <span class="nc">Student</span><span class="o">(</span><span class="nc">StudentId</span><span class="o">(</span><span class="mi">4815162342L</span><span class="o">),</span> <span class="s">"Kate"</span><span class="o">,</span> <span class="s">"1977-06-21"</span><span class="o">,</span> <span class="nc">NonEmptyList</span><span class="o">.</span><span class="n">of</span><span class="o">(</span>
    <span class="nc">Course</span><span class="o">(</span><span class="s">"airline pilot"</span><span class="o">,</span> <span class="mi">8150</span><span class="o">),</span>
    <span class="nc">Course</span><span class="o">(</span><span class="s">"US marshall"</span><span class="o">,</span> <span class="mi">4912</span><span class="o">)</span>
<span class="o">))</span>
<span class="c1">// student: Student = Student(StudentId(4815162342),Kate,1977-06-21,NonEmptyList(Course(airline pilot,8150.0), Course(US marshall,4912.0)))
</span>
<span class="k">val</span> <span class="n">bytes</span> <span class="k">=</span> <span class="n">studentEncoder</span><span class="o">.</span><span class="n">encodeAsBytes</span><span class="o">(</span><span class="n">student</span><span class="o">)</span>
<span class="c1">// bytes: Array[Byte] = Array(8, -26, -105, -122, -8, 17, 18, 4, 75, 97, 116, 101, 34, 10, 49, 57, 55, 55, 45, 48, 54, 45, 50, 49, 66, 24, 10, 13, 97, 105, 114, 108, 105, 110, 101, 32, 112, 105, 108, 111, 116, 17, 0, 0, 0, 0, 0, -42, -65, 64, 66, 22, 10, 11, 85, 83, 32, 109, 97, 114, 115, 104, 97, 108, 108, 17, 0, 0, 0, 0, 0, 48, -77, 64)
</span>
<span class="n">studentDecoder</span><span class="o">.</span><span class="n">decode</span><span class="o">(</span><span class="n">bytes</span><span class="o">)</span>
<span class="c1">// res6: io.protoless.messages.Decoder.Result[Student] = Right(Student(StudentId(4815162342),Kate,1977-06-21,NonEmptyList(Course(airline pilot,8150.0), Course(US marshall,4912.0))))
</span></code></pre></div></div>

<p>You can also use the syntaxic sugar <code class="highlighter-rouge">.as[A]</code> and <code class="highlighter-rouge">.asProtobufBytes</code> to replace the explicit call on decoders/encoders:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.protoless.syntax._</span>

<span class="n">student</span><span class="o">.</span><span class="n">asProtobufBytes</span>
<span class="n">bytes</span><span class="o">.</span><span class="n">as</span><span class="o">[</span><span class="kt">Student</span><span class="o">]</span>
</code></pre></div></div>

<h3 id="literal-types">Literal types</h3>

<p>If your project use the typelevel <a href="https://github.com/typelevel/scala/">fork</a> of Scala, you can define the field mapping
with <a href="https://github.com/typelevel/scala/blob/typelevel-readme/notes/typelevel-4.md#literal-types-pull5310-milesabin">Literal types</a>.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">type</span> <span class="kt">StudentMapping</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">::</span> <span class="mi">2</span> <span class="o">::</span> <span class="mi">4</span> <span class="o">::</span> <span class="mi">8</span> <span class="o">::</span> <span class="nc">HNil</span>
</code></pre></div></div>

<h2 id="fully-automatic-derivation">Fully Automatic derivation</h2>

<p>Automatically derive the required decoder/encoders, using the <code class="highlighter-rouge">automatic field numbering</code> strategy.</p>

<p>This approach requires less code, but only works if your messages are numbered consecutively starting from one.</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.protoless.generic.auto._</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Cloud</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">nickname</span><span class="k">:</span> <span class="kt">Char</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Unicorn</span><span class="o">(</span><span class="n">color</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">canFlight</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">,</span> <span class="n">locations</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">Cloud</span><span class="o">])</span>

<span class="k">val</span> <span class="n">unicorn</span> <span class="k">=</span> <span class="nc">Unicorn</span><span class="o">(</span><span class="s">"pink"</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="nc">Seq</span><span class="o">(</span><span class="nc">Cloud</span><span class="o">(</span><span class="s">"Celestial"</span><span class="o">,</span> <span class="sc">'c'</span><span class="o">),</span> <span class="nc">Cloud</span><span class="o">(</span><span class="s">"Misty Cheeky"</span><span class="o">,</span> <span class="sc">'m'</span><span class="o">)))</span>

<span class="k">val</span> <span class="n">bytes</span> <span class="k">=</span> <span class="n">unicorn</span><span class="o">.</span><span class="n">asProtobufBytes</span>

<span class="n">bytes</span><span class="o">.</span><span class="n">as</span><span class="o">[</span><span class="kt">Unicorn</span><span class="o">]</span>
</code></pre></div></div>

<h2 id="hand-crafted-encodersdecoders">Hand-crafted encoders/decoders</h2>

<p><code class="highlighter-rouge">Hand-crafted</code> encoders and decoders give you a total control on how your objects are encoded and decoded.
For each field you have to define how and where to read/write it .</p>

<p>It’s useful if you want to validate or transform protobuf message to fit your model.</p>

<div class="language-protobuf highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">message</span> <span class="nc">Meteo</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">city</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="kt">string</span> <span class="na">country</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kt">int32</span> <span class="na">temperature</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="c1">// in °F
</span>  <span class="kt">float</span> <span class="na">wind</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="kt">float</span> <span class="na">humidity</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">// optional
</span><span class="p">}</span>
</code></pre></div></div>
<p><br /></p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">case</span> <span class="k">class</span> <span class="nc">Location</span><span class="o">(</span><span class="n">country</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">city</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Celcius</span><span class="o">(</span><span class="n">temp</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span>

<span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Weather</span>
<span class="k">case</span> <span class="k">object</span> <span class="nc">Sunny</span> <span class="k">extends</span> <span class="nc">Weather</span>
<span class="k">case</span> <span class="k">class</span> <span class="nc">Rainy</span><span class="o">(</span><span class="n">humidity</span><span class="k">:</span> <span class="kt">Float</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Weather</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Meteo</span><span class="o">(</span><span class="n">location</span><span class="k">:</span> <span class="kt">Location</span><span class="o">,</span> <span class="n">temp</span><span class="k">:</span> <span class="kt">Celcius</span><span class="o">,</span> <span class="n">weather</span><span class="k">:</span> <span class="kt">Weather</span><span class="o">)</span>
</code></pre></div></div>
<p><br /></p>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">io.protoless.messages._</span><span class="o">,</span> <span class="n">io</span><span class="o">.</span><span class="n">protoless</span><span class="o">.</span><span class="n">syntax</span><span class="o">.</span><span class="k">_</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">meteoDecoder</span> <span class="k">=</span> <span class="nc">Decoder</span><span class="o">.</span><span class="n">instance</span><span class="o">[</span><span class="kt">Meteo</span><span class="o">](</span><span class="n">input</span> <span class="k">=&gt;</span>
  <span class="k">for</span> <span class="o">{</span>
    <span class="n">city</span> <span class="k">&lt;-</span> <span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="c1">// if nothing is specified, index are automatically incremented
</span>    <span class="n">country</span> <span class="k">&lt;-</span> <span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="o">[</span><span class="kt">String</span><span class="o">].</span><span class="n">map</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">toUpperCase</span><span class="o">)</span>
    <span class="n">temp</span> <span class="k">&lt;-</span> <span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="o">[</span><span class="kt">Int</span><span class="o">].</span><span class="n">map</span><span class="o">(</span><span class="n">f</span> <span class="k">=&gt;</span> <span class="nc">Celcius</span><span class="o">((</span><span class="n">f</span><span class="o">-</span><span class="mf">32f</span><span class="o">)/</span><span class="mf">1.8f</span><span class="o">))</span>
    <span class="c1">// we don't care about wind
</span>    <span class="n">weather</span> <span class="k">&lt;-</span> <span class="n">input</span><span class="o">.</span><span class="n">read</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Float</span><span class="o">]](</span><span class="mi">5</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">humidity</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Rainy</span><span class="o">(</span><span class="n">humidity</span><span class="o">)</span>
      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="nc">Sunny</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="k">yield</span> <span class="nc">Meteo</span><span class="o">(</span><span class="nc">Location</span><span class="o">(</span><span class="n">city</span><span class="o">,</span> <span class="n">country</span><span class="o">),</span> <span class="n">temp</span><span class="o">,</span> <span class="n">weather</span><span class="o">)</span>
<span class="o">)</span>

<span class="k">implicit</span> <span class="k">val</span> <span class="n">meteoEncoder</span> <span class="k">=</span> <span class="nc">Encoder</span><span class="o">.</span><span class="n">instance</span><span class="o">[</span><span class="kt">Meteo</span><span class="o">]{</span> <span class="n">meteo</span> <span class="k">=&gt;</span>
  <span class="n">output</span> <span class="k">=&gt;</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">meteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">city</span><span class="o">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="n">meteo</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">country</span><span class="o">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="o">[</span><span class="kt">Int</span><span class="o">]((</span><span class="n">meteo</span><span class="o">.</span><span class="n">temp</span><span class="o">.</span><span class="n">temp</span> <span class="o">*</span> <span class="mf">1.8f</span> <span class="o">-</span> <span class="mi">32</span><span class="o">).</span><span class="n">toInt</span><span class="o">)</span>
    <span class="n">output</span><span class="o">.</span><span class="n">write</span><span class="o">[</span><span class="kt">Option</span><span class="o">[</span><span class="kt">Float</span><span class="o">]](</span><span class="n">meteo</span><span class="o">.</span><span class="n">weather</span> <span class="k">match</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Rainy</span><span class="o">(</span><span class="n">humidity</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="n">humidity</span><span class="o">)</span>
      <span class="k">case</span> <span class="k">_</span> <span class="k">=&gt;</span> <span class="nc">None</span>
    <span class="o">},</span> <span class="mi">5</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></div></div>
<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">val</span> <span class="n">bytes</span> <span class="k">=</span> <span class="n">meteoEncoder</span><span class="o">.</span><span class="n">encodeAsBytes</span><span class="o">(</span><span class="nc">Meteo</span><span class="o">(</span><span class="nc">Location</span><span class="o">(</span><span class="s">"France"</span><span class="o">,</span> <span class="s">"Montpellier"</span><span class="o">),</span> <span class="nc">Celcius</span><span class="o">(</span><span class="mi">38</span><span class="o">),</span> <span class="nc">Sunny</span><span class="o">))</span>
<span class="c1">// bytes: Array[Byte] = Array(10, 11, 77, 111, 110, 116, 112, 101, 108, 108, 105, 101, 114, 18, 6, 70, 114, 97, 110, 99, 101, 24, 36)
</span>
<span class="n">bytes</span><span class="o">.</span><span class="n">as</span><span class="o">[</span><span class="kt">Meteo</span><span class="o">]</span>
<span class="c1">// res4: io.protoless.messages.Decoder.Result[Meteo] = Right(Meteo(Location(Montpellier,FRANCE),Celcius(2.2222223),Sunny))
</span></code></pre></div></div>

</section></div></div></div></div><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="/protoless/highlight/highlight.pack.js"></script><script>hljs.configure({
languages:['scala','java','bash']
});
hljs.initHighlighting();
             </script><script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.6/flowchart.min.js"></script><script>((window.gitter = {}).chat = {}).options = {
room: 'protoless/Lobby'};</script><script src="https://sidecar.gitter.im/dist/sidecar.v1.js"></script><script src="/protoless/js/main.js"></script></body></html>